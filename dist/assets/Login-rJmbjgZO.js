import{r as o,j as t,s as n}from"./index-Br0eYwCb.js";const N=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){const a=Math.random()*16|0;return(m==="x"?a:a&3|8).toString(16)});function L({onLogin:m,showNotification:a,initialView:b}){const[h,d]=o.useState(!1),[i,_]=o.useState(""),[c,C]=o.useState(""),[w,I]=o.useState(""),[e,l]=o.useState(b||"login"),[y,u]=o.useState(null),[v,P]=o.useState(""),[p,k]=o.useState(0),[q,j]=o.useState(!1);o.useEffect(()=>{(window.location.hash.includes("type=recovery")||window.location.href.includes("type=recovery"))&&l("update"),(window.location.hash.includes("type=invite")||window.location.href.includes("type=invite"))&&(l("update"),a("Welcome! Please set your password to complete your account setup."))},[]),o.useEffect(()=>{let s;return p>0&&(s=setInterval(()=>{k(r=>r-1)},1e3)),()=>clearInterval(s)},[p]);const S=async s=>{s&&s.preventDefault(),d(!0),u(null),j(!0);try{const{error:r}=await n.auth.signInWithOtp({email:i,options:{shouldCreateUser:!1}});if(r)throw r;l("otp_verify"),k(60),a("Login code sent to your email!")}catch(r){u(r.message),a(r.message,"error")}finally{d(!1),j(!1)}},E=async s=>{s.preventDefault(),d(!0),u(null);try{const{data:r,error:x}=await n.auth.verifyOtp({email:i,token:v,type:"email"});if(x)throw x;if(r.user){const g=N(),{error:f}=await n.from("profiles").update({current_session_id:g}).eq("id",r.user.id);f&&console.error("Error updating session ID:",f),localStorage.setItem("slm_session_id",g),m(r.user)}}catch(r){u(r.message),a(r.message,"error")}finally{d(!1)}},U=async s=>{s.preventDefault(),d(!0),u(null);try{if(e==="signup"){const{error:r}=await n.auth.signUp({email:i,password:c});if(r)throw r;a("Check your email for the login link!")}else if(e==="login"){const{data:r,error:x}=await n.auth.signInWithPassword({email:i,password:c});if(x)throw x;if(r.user){const g=N(),{error:f}=await n.from("profiles").update({current_session_id:g}).eq("id",r.user.id);f&&console.error("Error updating session ID:",f),localStorage.setItem("slm_session_id",g),m(r.user)}}else if(e==="forgot"){const{error:r}=await n.auth.resetPasswordForEmail(i,{redirectTo:`${window.location.origin}${window.location.pathname}#/login`});if(r)throw r;a("Password reset link sent to your email!"),l("login")}else if(e==="update"){if(c!==w)throw new Error("Passwords do not match");const{error:r}=await n.auth.updateUser({password:c});if(r)throw r;a("Password updated successfully! You can now sign in."),l("login")}}catch(r){u(r.message),a(r.message,"error")}finally{d(!1)}};return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900 px-4 py-8",children:t.jsx("div",{className:"w-full max-w-sm",children:t.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-8",children:[t.jsx("div",{className:"mb-6",children:t.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:e==="signup"?"Create Account":e==="forgot"?"Reset Password":e==="update"?"New Password":e==="otp_request"?"Login with Code":e==="otp_verify"?"Verify Code":"Sign In"})}),e==="signup"&&t.jsx("div",{className:"mb-4 p-4 bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-200 text-sm rounded-lg border border-amber-200 dark:border-amber-800",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold mb-1",children:"Signup is by invitation only"}),t.jsx("p",{className:"text-xs",children:"New accounts can only be created through an invitation link. Please contact your administrator to receive an invitation email."})]})]})}),y&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-sm rounded-lg border border-red-200 dark:border-red-800",children:y}),t.jsxs("form",{onSubmit:e==="otp_request"?S:e==="otp_verify"?E:U,className:"space-y-4",children:[(e==="login"||e==="signup"||e==="forgot"||e==="otp_request")&&t.jsx("input",{type:"email",required:!0,value:i,onChange:s=>_(s.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Email address"}),(e==="login"||e==="signup"||e==="update")&&t.jsxs("div",{children:[t.jsx("input",{type:"password",required:!0,value:c,onChange:s=>C(s.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:e==="update"?"New password":"Password"}),e==="login"&&t.jsx("button",{type:"button",onClick:()=>l("forgot"),className:"text-xs text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"Forgot password?"})]}),e==="otp_verify"&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4 text-sm text-center text-slate-600 dark:text-slate-400",children:["Code sent to ",t.jsx("span",{className:"font-semibold text-slate-900 dark:text-slate-200",children:i})]}),t.jsx("input",{type:"text",required:!0,value:v,onChange:s=>P(s.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest font-mono",placeholder:"000000",maxLength:6}),t.jsx("div",{className:"mt-2 text-center",children:t.jsx("button",{type:"button",onClick:S,disabled:p>0||q,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50 disabled:cursor-not-allowed",children:p>0?`Resend code in ${p}s`:"Resend Code"})})]}),e==="update"&&t.jsx("input",{type:"password",required:!0,value:w,onChange:s=>I(s.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Confirm password"}),t.jsx("button",{type:"submit",disabled:h,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:h?t.jsx("span",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e==="signup"?"Create Account":e==="forgot"?"Send Reset Link":e==="update"?"Update Password":e==="otp_request"?"Send Login Code":e==="otp_verify"?"Verify & Login":"Sign In"}),e==="login"&&t.jsxs("button",{type:"button",onClick:()=>l("otp_request"),className:"w-full py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 font-semibold rounded-lg transition-colors flex items-center justify-center gap-2",children:[t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Sign in with OTP"]})]}),t.jsxs("div",{className:"mt-6 text-center text-sm text-slate-600 dark:text-slate-400",children:[e==="signup"?"Already have an account?":e==="forgot"||e==="update"?"Remember your password?":"Don't have an account?"," ",t.jsx("button",{onClick:()=>{l(e==="otp_verify"?"otp_request":e==="signup"||e==="forgot"||e==="update"||e==="otp_request"?"login":"signup")},className:"text-blue-600 dark:text-blue-400 font-semibold hover:underline",children:e==="otp_verify"?"Change Email":e==="signup"||e==="forgot"||e==="update"||e==="otp_request"?"Sign In":"Sign Up"})]})]})})})}export{L as default};
